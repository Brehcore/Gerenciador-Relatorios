<div class="profile-page">
  <div class="profile-card">
    <div class="profile-header no-avatar">
      <div class="profile-meta">
        <div class="meta-top">
          <div>
            <h2 class="profile-name">{{ profile?.name || '-' }}</h2>
            <div class="profile-role">{{ profile?.role === 'ADMIN' ? 'Administrador' : 'UsuÃ¡rio' }}</div>
          </div>
          <div class="profile-actions-buttons">
            <button type="button" class="btn-change-password" (click)="openChangePasswordModal()" title="Alterar senha">
              ğŸ” Alterar Senha
            </button>
            <button type="button" class="btn-change-email" (click)="openChangeEmailModal()" title="Alterar email">
              ğŸ“§ Alterar Email
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="profile-details">
      <div class="info-grid">
        <div class="info-card">
          <div class="info-label">ğŸ‘¤ Perfil</div>
          <div class="info-value">{{ profile?.role === 'ADMIN' ? 'Administrador' : 'UsuÃ¡rio' }}</div>
        </div>
        <div class="info-card">
          <div class="info-label">ğŸ“§ Email</div>
          <div class="info-value">{{ profile?.email || '-' }}</div>
        </div>
        <div class="info-card">
          <div class="info-label">ğŸ“± Telefone</div>
          <div class="info-value">{{ profile?.phone || profile?.telefone || '-' }}</div>
        </div>
        <div class="info-card">
          <div class="info-label">ğŸ†” CPF</div>
          <div class="info-value">{{ profile?.cpf || '-' }}</div>
        </div>
        <div class="info-card">
          <div class="info-label">ğŸ“ Sigla Conselho</div>
          <div class="info-value">{{ profile?.siglaConselhoClasse || '-' }}</div>
        </div>
        <div class="info-card">
          <div class="info-label">ğŸ“œ Conselho / Registro</div>
          <div class="info-value">{{ profile?.conselhoClasse || profile?.registro || '-' }}</div>
        </div>
        <div class="info-card">
          <div class="info-label">ğŸ’¼ Especialidade</div>
          <div class="info-value">{{ profile?.especialidade || '-' }}</div>
        </div>
        <div class="info-card">
          <div class="info-label">ğŸ‚ Data de Nascimento</div>
          <div class="info-value">{{ formatDate(profile?.birthDate || profile?.dataNascimento) }}</div>
        </div>
        <div class="info-card">
          <div class="info-label">ğŸ” Certificado Digital</div>
          <div class="info-value">
            <a class="manage-certificate" routerLink="/certificado-digital">{{ hasCertificate && certificateValidity ? ('Validade: ' + certificateValidity) : 'Sem certificado digital' }}</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Alterar Senha -->
  <div class="modal-backdrop" *ngIf="showChangePasswordModal" (click)="closeChangePasswordModal()"></div>
  <div class="modal" *ngIf="showChangePasswordModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Alterar Senha</h3>
        <button type="button" class="modal-close" (click)="closeChangePasswordModal()" title="Fechar modal">âœ•</button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label for="currentPasswordForPassword">Sua Senha Atual *</label>
          <input 
            id="currentPasswordForPassword"
            type="password" 
            [(ngModel)]="currentPasswordForPassword" 
            placeholder="Confirme com sua senha atual"
            maxlength="100"
            title="Digite sua senha atual para confirmar" />
          <small *ngIf="currentPasswordForPassword.length > 0" class="form-hint">
            NecessÃ¡rio confirmar com sua senha atual
          </small>
        </div>

        <div class="form-group">
          <label for="newPassword">Nova Senha *</label>
          <input 
            id="newPassword"
            type="password" 
            [(ngModel)]="newPassword" 
            placeholder="MÃ­nimo 8 caracteres"
            maxlength="100"
            title="Digite a nova senha (mÃ­nimo 8 caracteres)" />
          <small *ngIf="newPassword.length > 0 && newPassword.length < 8" class="form-hint error">
            MÃ­nimo 8 caracteres ({{ newPassword.length }}/8)
          </small>
          <small *ngIf="newPassword.length >= 8" class="form-hint success">
            Comprimento de senha vÃ¡lido âœ“
          </small>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirmar Senha *</label>
          <input 
            id="confirmPassword"
            type="password" 
            [(ngModel)]="confirmPassword" 
            placeholder="Repita a senha"
            maxlength="100"
            title="Repita a nova senha" />
          <small *ngIf="confirmPassword && newPassword !== confirmPassword" class="form-hint error">
            As senhas nÃ£o conferem
          </small>
          <small *ngIf="confirmPassword && newPassword === confirmPassword && newPassword.length >= 8" class="form-hint success">
            Senhas coincidem âœ“
          </small>
        </div>
      </div>

      <div class="modal-footer">
        <button 
          type="button" 
          class="btn-secondary" 
          (click)="closeChangePasswordModal()">
          Cancelar
        </button>
        <button 
          type="button" 
          class="btn-primary"
          (click)="submitChangePassword()"
          [disabled]="changePasswordSubmitting || !newPassword || !confirmPassword || !currentPasswordForPassword || newPassword !== confirmPassword || newPassword.length < 8">
          {{ changePasswordSubmitting ? 'â³ Alterando...' : 'âœ“ Alterar Senha' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de Alterar Email -->
  <div class="modal-backdrop" *ngIf="showChangeEmailModal" (click)="closeChangeEmailModal()"></div>
  <div class="modal" *ngIf="showChangeEmailModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Alterar Email</h3>
        <button type="button" class="modal-close" (click)="closeChangeEmailModal()" title="Fechar modal">âœ•</button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label for="newEmail">Novo Email *</label>
          <input 
            id="newEmail"
            type="email" 
            [(ngModel)]="newEmail" 
            placeholder="seu.novo.email@exemplo.com"
            maxlength="100"
            title="Digite o seu novo email" />
          <small *ngIf="newEmail.length > 0 && !isValidEmail(newEmail)" class="form-hint error">
            Email invÃ¡lido
          </small>
          <small *ngIf="newEmail.length > 0 && isValidEmail(newEmail)" class="form-hint success">
            Email vÃ¡lido âœ“
          </small>
        </div>

        <div class="form-group">
          <label for="confirmEmail">Confirmar Email *</label>
          <input 
            id="confirmEmail"
            type="email" 
            [(ngModel)]="confirmEmail" 
            placeholder="Repita o email"
            maxlength="100"
            title="Repita o novo email" />
          <small *ngIf="confirmEmail && newEmail !== confirmEmail" class="form-hint error">
            Os emails nÃ£o conferem
          </small>
          <small *ngIf="confirmEmail && newEmail === confirmEmail && isValidEmail(newEmail)" class="form-hint success">
            Emails coincidem âœ“
          </small>
        </div>

        <div class="form-group">
          <label for="emailCurrentPassword">Sua Senha Atual *</label>
          <input 
            id="emailCurrentPassword"
            type="password" 
            [(ngModel)]="currentPassword" 
            placeholder="Confirme com sua senha"
            maxlength="100"
            title="Digite sua senha atual para confirmar" />
          <small *ngIf="currentPassword.length > 0" class="form-hint">
            NecessÃ¡rio confirmar com sua senha atual
          </small>
        </div>
      </div>

      <div class="modal-footer">
        <button 
          type="button" 
          class="btn-secondary" 
          (click)="closeChangeEmailModal()">
          Cancelar
        </button>
        <button 
          type="button" 
          class="btn-primary"
          (click)="submitChangeEmail()"
          [disabled]="changeEmailSubmitting || !newEmail || !confirmEmail || !currentPassword || newEmail !== confirmEmail || !isValidEmail(newEmail)">
          {{ changeEmailSubmitting ? 'â³ Alterando...' : 'âœ“ Alterar Email' }}
        </button>
      </div>
    </div>
  </div>
</div>
<div id="mainContent" class="main-content"></div>
